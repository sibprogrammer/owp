<%
  @page_title = t('admin.virtual_servers.show.title', 
    :name => @virtual_server.host_name.blank? ? "#" + @virtual_server.identity.to_s : @virtual_server.host_name )
%>

<% javascript_tag do -%>
Ext.onReady(function() {

  var store = new Ext.data.JsonStore({
    url: '/admin/virtual-servers/get_properties?id=<%= @virtual_server.id %>',
    root: 'data',
    autoLoad: true,
    fields: [
      { name: 'parameter' },
      { name: 'value' }
    ]
  });
  
  var virtualServerInfoGrid = new Ext.grid.GridPanel({
    id: 'virtualServerInfoGrid',
    title: '<%= tjs('admin.virtual_servers.show.grid.title') %>',
    loadMask: true,
    tools: [{ 
      id: 'refresh',
      handler: function() {
        virtualServerInfoGrid.getStore().reload();
      }
    }],
    iconCls: 'icon-items-list',
    store: store,
    autoWidth: true,
    stripeRows: true,
    autoExpandColumn: 'value',
    stateId: 'virtualServerInfoGrid',
    cm: new Ext.grid.ColumnModel([{
      id: 'parameter',
      header: '<%= tjs('admin.virtual_servers.show.grid.column.parameter') %>',
      width: 250,
      dataIndex: 'parameter'
    }, {
      id: 'value',
      header: '<%= tjs('admin.virtual_servers.show.grid.column.value') %>',
      dataIndex: 'value'
    }])
  });
  
  Owp.layout.addToCenter(virtualServerInfoGrid);

  var changeStateAction = function(action) {
    Owp.list.groupAction({
      gridName: 'virtualServerInfoGrid',
      url: '/admin/virtual-servers/change_state?ids=<%= @virtual_server.id %>',
      command: action,
      waitMsg: '<%= tjs('form.performing_task') %>',
      failure: {
        title: '<%= tjs('form.error.title') %>',
        msg: '<%= tjs('admin.virtual_servers.form.change_state.failed') %>'
      }
    });
  }

  var mainContentCenterPanel = Ext.getCmp('mainContentCenterPanel');
  mainContentCenterPanel.getTopToolbar().insertButton(0, {
    text: '<%= tjs('admin.virtual_servers.grid.button.change_state') %>',
    iconCls: 'icon-button-change-state',
    ref: '../changeStateButton',
    menu: [{
      text: '<%= tjs('admin.virtual_servers.grid.button.start') %>',
      iconCls: 'icon-button-start-server',
      handler: changeStateAction.createCallback('start')
    }, {
      text: '<%= tjs('admin.virtual_servers.grid.button.stop') %>',
      iconCls: 'icon-button-stop-server',
      handler: changeStateAction.createCallback('stop')
    }, {
      text: '<%= tjs('admin.virtual_servers.grid.button.restart') %>',
      iconCls: 'icon-button-restart-server',
      handler: changeStateAction.createCallback('restart')
    }] 
  });
  mainContentCenterPanel.doLayout()

});
<% end -%>